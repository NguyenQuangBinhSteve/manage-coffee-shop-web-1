@model List<manage_coffee_shop_web.Models.Product>
@* Add this at the top of the file *@
@using manage_coffee_shop_web.Models

@{
    ViewData["Title"] = "Home - manage_coffee_shop_web";
    var bannerImagePath = ViewBag.BannerImagePath ?? "/images/banners/default.jpg"; // Fallback image if null
    var bannerTitle = string.IsNullOrEmpty(ViewBag.BannerTitle) ? "No Title" : ViewBag.BannerTitle;
    var bannerDescription = string.IsNullOrEmpty(ViewBag.BannerDescription) ? "No Description" : ViewBag.BannerDescription;
}

<!-- Banner Section -->
<div class="banner mb-5">
    <div class="banner-slides"></div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const slidesContainer = document.querySelector(".banner-slides");
        const banners = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.Banners ?? new List<Banner>()));

        if (banners.length > 0) {
            let slideIndex = 0;

            slidesContainer.innerHTML = banners.map(banner =>
                `<div class="banner-slide" style="--bg:url('${banner.Image}')"></div>`
            ).join('');

            function showSlide(index) {
                const slides = document.querySelectorAll(".banner-slide");
                if (index >= slides.length) slideIndex = 0;
                if (index < 0) slideIndex = slides.length - 1;
                slides.forEach((slide, i) => {
                    slide.style.opacity = 0;
                    if (i === slideIndex) slide.style.opacity = 1;
                });
            }

            function nextSlide() {
                slideIndex++;
                showSlide(slideIndex);
            }

            showSlide(slideIndex);
            setInterval(nextSlide, 8000);
        }
    });
</script>

<!-- Products Section (#US002) -->
<section class="products" id="products">
    <div class="container">
        <h1 class="heading"><span>SẢN</span> PHẨM</h1>
        <!-- Advanced Search Form -->
        <form asp-action="Index" asp-controller="Home" method="get" class="search-form">
            <div class="row align-items-end">
                <div class="col-md-3">
                    <label for="categoryId" class="form-label">Category</label>
                    <select class="form-select" id="categoryId" name="categoryId">
                        <option value="">All Categories</option>
                        @foreach (var category in (ViewBag.Categories as IEnumerable<Category>) ?? Enumerable.Empty<Category>())
                        {
                            if (category != null && category.Id != null && category.Name != null)
                            {
                                var selectedCategoryId = ViewBag.SelectedCategoryId as int?;
                                var isSelected = selectedCategoryId.HasValue && category.Id == selectedCategoryId.Value;
                                if (isSelected)
                                {
                                    <option value="@category.Id" selected>@category.Name</option>
                                }
                                else
                                {
                                    <option value="@category.Id">@category.Name</option>
                                }
                            }
                        }
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="searchTerm" class="form-label">Tên Sản Phẩm</label>
                    <input type="text" class="form-control" id="searchTerm" name="searchTerm" value="@ViewBag.SearchTerm" placeholder="Nhập Tên Sản Phẩm..." />
                </div>
                <div class="col-md-3">
                    <label for="minPrice" class="form-label">Gía từ thấp</label>
                    <input type="number" class="form-control" id="minPrice" name="minPrice" value="@ViewBag.MinPrice" min="0" step="0.01" placeholder="Gía từ thấp..." />
                </div>
                <div class="col-md-2">
                    <label for="maxPrice" class="form-label">Gía tối đa</label>
                    <input type="number" class="form-control" id="maxPrice" name="maxPrice" value="@ViewBag.MaxPrice" min="0" step="0.01" placeholder="Gía tối đa..." />
                </div>
                <div class="col-md-1">
                    <button type="submit" class="btn btn-custom-search"><i class="fas fa-search"></i></button>
                </div>
            </div>
        </form>
        <div class="row">
            <div class="col-md-12">
                
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    @foreach (var product in Model ?? Enumerable.Empty<manage_coffee_shop_web.Models.Product>())
                    {
                        <div class="col">
                            <div class="card product-card h-100">
                                <a href="@Url.Action("Category", "Product")">
                                    <img src="@product.Image" class="card-img-top" alt="@product.Name" loading="lazy" />
                                </a>
                                <div class="card-body">
                                    <h5 class="card-title">@product.Name</h5>
                                    <p class="card-text price">@string.Format("{0:N0} VNĐ", product.Price)</p>
                                    <a href="@Url.Action("Category", "Product")" class="btn btn-sm btn-success mt-2">Xem Chi Tiết</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Home Section (#US001) -->
<section class="home" id="home" style="background-image: url('/images/home/background.jpg');">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="image">
                    <img src="/images/home/home-img.jpg" alt="Home Image" class="img-fluid" />
                </div>
            </div>
            <div class="col-md-6">
                <div class="content right-content">
                    <h3>Fresh Coffee with Chicken COFFEE</h3>
                    <p>
                        “Hạt cà phê luôn tươi mới, rang xay chuẩn gu.
                        Bộ dụng cụ pha chế chất lượng giúp tôi dễ dàng tự làm cà phê tại nhà.
                        Rất hài lòng với dịch vụ của BOTT COFFEE!”
                        <br>
                        <strong>Bình Gold., Khách hàng thân thiết</strong>
                    </p>
                    <p>Khám phá các dòng hạt cà phê và dụng cụ pha chế được tuyển chọn dành riêng cho bạn.</p>
                    <a href="#products" class="btn">Mua Ngay</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- About Section -->
<section class="about" id="about">
    <div class="container">
        <h1 class="heading"><span>VỀ</span> CHÚNG TÔI</h1>
        <div class="row">
            <div class="image col-md-6">
                <img src="/images/home/about-img.png" alt="About Us" class="img-fluid">
            </div>
            <div class="content col-md-6">
                <h3>Điều Gì Làm Chúng Tôi Khác Biệt?</h3>
                <p>
                    Chúng tôi không chỉ cung cấp <b>các loại hạt cà phê nguyên chất</b> tuyển chọn từ nhiều vùng trồng nổi tiếng,
                    mà còn mang đến <b>tool và dụng cụ pha chế chuyên nghiệp</b> giúp bạn tạo ra những ly cà phê chuẩn gu ngay tại nhà hay quán.
                </p>
                <p>
                    Mỗi sản phẩm đều được chọn lọc kỹ lưỡng để đảm bảo <b>chất lượng, độ bền và sự tiện dụng</b>.
                    Chúng tôi tin rằng, một trải nghiệm cà phê tuyệt vời bắt đầu từ <b>hạt cà phê tinh khiết</b>
                    và <b>công cụ pha chế phù hợp</b>.
                </p>
                <a asp-area="" asp-controller="Account" asp-action="Register" class="btn">Đăng Ký</a>
            </div>
        </div>
    </div>
</section>

<!-- Menu Section (#US006, #US007) -->
<section class="menu" id="menu">
    <div class="container">
        <h1 class="heading"><span>COFFEE</span> CỦA QUÁN</h1>
        <div class="row">
            <div class="col-md-12">
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    <div class="col">
                        <div class="card menu-item h-100">
                            <img src="/images/product-img/CoffeeDen.jpg" class="card-img-top" alt="Coffee Đen" loading="lazy" />
                            <div class="card-body">
                                <h5 class="card-title">Coffee Đen</h5>
                                <p class="card-text price">15000 VNĐ</p>
                                <p class="card-text flavor">Hương vị đậm đà, mạnh mẽ với hậu vị nhẹ nhàng của Robusta rang xay.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card menu-item h-100">
                            <img src="/images/product-img/CoffeeSua.jpg" class="card-img-top" alt="Coffee Sữa" loading="lazy" />
                            <div class="card-body">
                                <h5 class="card-title">Coffee Sữa</h5>
                                <p class="card-text price">17000 VNĐ</p>
                                <p class="card-text flavor">Kết hợp đắng nhẹ của cà phê và ngọt ngào, béo ngậy của sữa đặc.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card menu-item h-100">
                            <img src="/images/product-img/Americano.jpg" class="card-img-top" alt="Americano" loading="lazy" />
                            <div class="card-body">
                                <h5 class="card-title">Americano</h5>
                                <p class="card-text price">20000 VNĐ</p>
                                <p class="card-text flavor">Hương thơm nhẹ, vị cà phê thanh thoát với nước nóng hòa quyện.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card menu-item h-100">
                            <img src="/images/product-img/Cappuccino.jpg" class="card-img-top" alt="Cappuccino" loading="lazy" />
                            <div class="card-body">
                                <h5 class="card-title">Cappuccino</h5>
                                <p class="card-text price">20000 VNĐ</p>
                                <p class="card-text flavor">Vị cà phê đậm kết hợp với bọt sữa mịn, chút ngọt nhẹ từ đường.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card menu-item h-100">
                            <img src="/images/product-img/CoffeeMuoi.jpg" class="card-img-top" alt="Coffee Muối" loading="lazy" />
                            <div class="card-body">
                                <h5 class="card-title">Coffee Muối</h5>
                                <p class="card-text price">25000 VNĐ</p>
                                <p class="card-text flavor">Hương vị độc đáo với chút mặn nhẹ, hòa quyện cùng vị đắng của cà phê.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card menu-item h-100">
                            <img src="/images/product-img/CoffeeTrung.jpg" class="card-img-top" alt="Coffee Trứng" loading="lazy" />
                            <div class="card-body">
                                <h5 class="card-title">Coffee Trứng</h5>
                                <p class="card-text price">25000 VNĐ</p>
                                <p class="card-text flavor">Hương vị béo ngậy của trứng gà kết hợp với đắng nhẹ của cà phê.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- News Section (Formerly Reviews) -->
<section class="news" id="news">
    <div class="container">
        <h1 class="heading"><span>Tin Tức</span> & Bài Viết</h1>
        <div class="row row-cols-1 row-cols-md-3 g-4">

            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Ra Mắt Dòng Hạt Cà Phê Mới</h5>
                        <p class="card-text">
                            Khám phá hương vị độc đáo từ lô hạt cà phê rang xay mới nhất –
                            được tuyển chọn kỹ lưỡng từ nông trại chất lượng cao.
                        </p>
                        <p class="text-muted">Xuất bản ngày 01/09/2025</p>
                        <a href="#" class="btn btn-sm">Xem Thêm</a>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Dụng Cụ Pha Chế Mới Về</h5>
                        <p class="card-text">
                            Bộ sưu tập tool pha cà phê chuyên nghiệp đã có mặt,
                            giúp bạn dễ dàng tạo nên ly cà phê chuẩn barista ngay tại nhà.
                        </p>
                        <p class="text-muted">Xuất bản ngày 03/09/2025</p>
                        <a href="#" class="btn btn-sm">Xem Thêm</a>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Khai Trương Showroom Mới</h5>
                        <p class="card-text">
                            Trải nghiệm trực tiếp các loại hạt cà phê và dụng cụ pha chế
                            tại showroom mới của chúng tôi ở Quận 1.
                        </p>
                        <p class="text-muted">Xuất bản ngày 05/09/2025</p>
                        <a href="#" class="btn btn-sm">Xem Thêm</a>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>


<!-- Contact Section -->
<section class="contact" id="contact">
    <div class="container">
        <h1 class="heading"><span>Contact</span> Us</h1>
        <div class="row">
            <!-- Left: Map + Info -->
            <div class="col-md-6">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3920.0987465358617!2d106.6372448509867!3d10.72686676604185!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752ff232d1450b%3A0x3659e3c94323e995!2sCoffee%20BOTT!5e0!3m2!1sen!2s!4v1753882951554!5m2!1sen!2s"
                        width="100%" height="300" style="border:0;" allowfullscreen loading="lazy"></iframe>
                <p class="mt-3"><i class="fas fa-map-marker-alt"></i> 123 Coffee St, Ho Chi Minh City</p>
                <p><i class="fas fa-phone"></i> +84 123 456 789</p>
                <p><i class="fas fa-envelope"></i> info@coffeehaven.com</p>
                <p><i class="fas fa-clock"></i> Mon-Fri: 8 AM - 10 PM</p>
            </div>

            <!-- Right: CTA -->
            <div class="col-md-6 d-flex flex-column justify-content-center align-items-center text-center">
                <div class="content-box">
                    <h3 class="mb-3">Trở thành khách hàng thân thiết của chúng tôi!</h3>
                    <p class="mb-4">Đăng ký ngay để nhận ưu đãi, tin tức và trải nghiệm dịch vụ tốt nhất.</p>
                    <a asp-area="" asp-controller="Account" asp-action="Register" class="btn">Đăng Ký Ngay</a>
                </div>
            </div>
        </div>
    </div>
</section>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const banner = document.querySelector(".banner");
        const imagePath = banner.getAttribute("data-image");
        if (imagePath) {
            // Keep the image visible if background fails
            banner.style.backgroundImage = `url('${imagePath}')`;
        } else {
            banner.querySelector("img").style.display = "block"; // Ensure image is visible as fallback
        }
    });

    // Add to cart
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', (e) => {
            e.preventDefault();
            const productId = button.getAttribute('data-id');
            fetch('/Cart/Add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId, quantity: 1 })
            }).then(response => response.json()).then(data => {
                alert(data.message || 'Added to cart!');
            }).catch(error => console.error('Error:', error));
        });
    });

    // Contact form validation and submission
    (function () {
        'use strict';
        const form = document.getElementById('contactForm');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (form.checkValidity()) {
                fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form)
                }).then(response => response.json()).then(data => {
                    document.getElementById('contactMessage').textContent = data.message;
                    document.getElementById('contactMessage').style.display = 'block';
                    form.reset();
                    form.classList.remove('was-validated');
                }).catch(error => console.error('Error:', error));
            } else {
                form.classList.add('was-validated');
            }
        });
    })();
</script>